<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competitive Exam Books - Booksy</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <meta name="description" content="Books for UPSC, SSC, Banking, Railways and other competitive exams">
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <h1><a href="index.html">BOOKSY</a></h1>
            </div>
            <nav class="navbar">
                <a href="index.html">Home</a>
                <a href="Book.html">Buy Books</a>
                <a href="Sell.html">Sell Books</a>
                <a href="Novels.html">Novels</a>
                <a href="12th.html">12th Class</a>
                <a href="Jee.html">JEE</a>
                <a href="Competitive-exams.html" class="active">Competitive Exams</a>
                <a href="Science-and-tech.html">Science & Tech</a>
                <a href="Profile.html">Profile</a>
                <a href="Login.html">Login</a>
                <a href="Register.html">Register</a>
                <a href="Contact.html">Contact</a>
            </nav>
        </div>
    </header>

    <section style="padding: 40px 20px; text-align: center; background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
        <h2 style="font-size: 2.5rem; color: #1e3d59; margin-bottom: 10px;">üéØ Competitive Exam Books</h2>
        <p style="font-size: 1.2rem; color: #666;">Books for UPSC, SSC, Banking, Railways and other competitive exams</p>
    </section>

    <section class="search-container">
        <input type="text" class="search-box" id="searchInput" placeholder="Search books in this category...">
        <div class="filter-buttons">
            <button class="filter-btn active" data-sort="newest">Newest First</button>
            <button class="filter-btn" data-sort="price-low">Price: Low to High</button>
            <button class="filter-btn" data-sort="price-high">Price: High to Low</button>
            <button class="filter-btn" data-sort="title">Title A-Z</button>
        </div>
    </section>

    <section class="book-grid" id="booksContainer">
        <div class="loading">
            <div class="spinner"></div>
            <p>Loading competitive books...</p>
        </div>
    </section>

    <div id="noResults" class="text-center" style="padding: 40px; display: none;">
        <h3>No books found in this category</h3>
        <p>Be the first to list a book in this category!</p>
        <a href="Sell.html" class="btn-primary" style="display: inline-block; margin-top: 20px;">List Your Book</a>
    </div>

    <section style="padding: 40px 20px; text-align: center; background: linear-gradient(135deg, #1e3d59, #ff6f61); color: white; margin-top: 40px;">
        <h3 style="margin-bottom: 20px; font-size: 1.8rem;">Have books in this category?</h3>
        <p style="margin-bottom: 25px; font-size: 1.1rem;">Help other students by selling your competitive books</p>
        <a href="Sell.html" class="btn-primary" style="background: white; color: #1e3d59; text-decoration: none;">üìù Sell Your Books</a>
    </section>

    <footer>
        <p>&copy; 2024 Booksy.com. All rights reserved.</p>
        <p><a href="Contact.html">Contact Us</a> | <a href="Profile.html">Profile</a></p>
    </footer>

    <script src="/static/js/main.js"></script>
    <script>
        const CATEGORY = 'competitive';
        let allBooks = [];
        let filteredBooks = [];

        // Load books when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadCategoryBooks();
            initializeEventListeners();
        });

        async function loadCategoryBooks() {
            try {
                const response = await fetch(`/api/books?category=${CATEGORY}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch books');
                }

                allBooks = await response.json();
                // Filter books by category (server-side filtering might not be perfect)
                allBooks = allBooks.filter(book => 
                    book.category.toLowerCase().includes(CATEGORY.toLowerCase()) ||
                    (CATEGORY === 'novels' && book.category.toLowerCase().includes('fiction')) ||
                    (CATEGORY === 'technical' && (book.category.toLowerCase().includes('science') || book.category.toLowerCase().includes('technology')))
                );

                filteredBooks = [...allBooks];
                displayBooks(allBooks);

            } catch (error) {
                console.error('Error loading books:', error);
                const container = document.getElementById('booksContainer');
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h3>Unable to load books</h3>
                        <p>Please check your connection and try again.</p>
                        <button class="btn-primary" onclick="loadCategoryBooks()">Retry</button>
                    </div>
                `;
            }
        }

        function initializeEventListeners() {
            // Search functionality
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', Booksy.debounce(handleSearch, 300));

            // Sort buttons
            const sortBtns = document.querySelectorAll('.filter-btn');
            sortBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons
                    sortBtns.forEach(b => b.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');

                    const sortBy = this.getAttribute('data-sort');
                    handleSort(sortBy);
                });
            });
        }

        function handleSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();

            if (searchTerm === '') {
                filteredBooks = [...allBooks];
            } else {
                filteredBooks = allBooks.filter(book => 
                    book.title.toLowerCase().includes(searchTerm) ||
                    book.author.toLowerCase().includes(searchTerm) ||
                    (book.description && book.description.toLowerCase().includes(searchTerm))
                );
            }

            displayBooks(filteredBooks);
        }

        function handleSort(sortBy) {
            let sortedBooks = [...filteredBooks];

            switch(sortBy) {
                case 'price-low':
                    sortedBooks.sort((a, b) => a.price - b.price);
                    break;
                case 'price-high':
                    sortedBooks.sort((a, b) => b.price - a.price);
                    break;
                case 'title':
                    sortedBooks.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                case 'newest':
                default:
                    sortedBooks.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                    break;
            }

            displayBooks(sortedBooks);
        }

        function displayBooks(books) {
            const container = document.getElementById('booksContainer');
            const noResults = document.getElementById('noResults');

            if (books.length === 0) {
                container.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }

            container.style.display = 'grid';
            noResults.style.display = 'none';

            container.innerHTML = books.map((book, index) => `
                <div class="book-card slide-up" style="animation-delay: ${index * 0.1}s">
                    ${book.image_url ? `<img src="${book.image_url}" alt="${book.title}" style="width: 100%; max-width: 150px; height: auto; border-radius: 8px; margin-bottom: 15px;">` : ''}
                    <h3>${book.title}</h3>
                    <p><strong>Author:</strong> ${book.author}</p>
                    <p class="description">${book.description || 'No description available'}</p>
                    <div class="price">‚Çπ${book.price}</div>
                    ${book.original_price && book.original_price > book.price ? 
                        `<p style="text-decoration: line-through; color: #999;"><strong>Original:</strong> ‚Çπ${book.original_price}</p>
                         <p style="color: #28a745; font-weight: 600;">Save: ‚Çπ${book.original_price - book.price}</p>` : ''}
                    <span class="condition">${book.condition} Condition</span>
                    <p><strong>Seller:</strong> ${book.owner_name}</p>
                    ${book.location ? `<p><strong>Location:</strong> ${book.location}</p>` : ''}
                    <p><strong>Listed:</strong> ${Booksy.getRelativeTime(book.created_at)}</p>
                    <button class="btn-primary" onclick="Booksy.contactSeller('${book.title}', '${book.owner_name}', '${book.owner_phone || ''}', '${book.contact_info || ''}')">
                        Contact Seller
                    </button>
                </div>
            `).join('');
        }
    </script>

    <style>
        .navbar a.active {
            background-color: rgba(255, 111, 97, 0.2);
            color: #ff6f61;
        }

        .description {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .description:hover {
            color: #1e3d59;
        }
    </style>
</body>
</html>